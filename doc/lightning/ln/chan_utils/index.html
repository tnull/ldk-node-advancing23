<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Various utilities for building scripts and deriving keys related to channels. These are largely of interest for those implementing chain::keysinterface::Sign message signing by hand."><meta name="keywords" content="rust, rustlang, rust-lang, chan_utils"><title>lightning::ln::chan_utils - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../../normalize.css"><link rel="stylesheet" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../../ayu.css" disabled><link rel="stylesheet" href="../../../dark.css" disabled><link rel="stylesheet" href="../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../storage.js"></script><script defer src="../../../main.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../lightning/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../../lightning/index.html"><div class="logo-container"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Module chan_utils</a></h2><div class="sidebar-elems"><section><div class="block"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#functions">Functions</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../../lightning/index.html"><img class="rust-logo" src="../../../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn"><span class="in-band">Module <a href="../../index.html">lightning</a>::<wbr><a href="../index.html">ln</a>::<wbr><a class="mod" href="#">chan_utils</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../../src/lightning/ln/chan_utils.rs.html#10-2118">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Various utilities for building scripts and deriving keys related to channels. These are
largely of interest for those implementing chain::keysinterface::Sign message signing by hand.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.BuiltCommitmentTransaction.html" title="lightning::ln::chan_utils::BuiltCommitmentTransaction struct">BuiltCommitmentTransaction</a></div><div class="item-right docblock-short">A pre-built Bitcoin commitment transaction and its txid.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ChannelPublicKeys.html" title="lightning::ln::chan_utils::ChannelPublicKeys struct">ChannelPublicKeys</a></div><div class="item-right docblock-short">One counterparty’s public keys which do not change over the life of a channel.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ChannelTransactionParameters.html" title="lightning::ln::chan_utils::ChannelTransactionParameters struct">ChannelTransactionParameters</a></div><div class="item-right docblock-short">Per-channel data used to build transactions in conjunction with the per-commitment data (CommitmentTransaction).
The fields are organized by holder/counterparty.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ClosingTransaction.html" title="lightning::ln::chan_utils::ClosingTransaction struct">ClosingTransaction</a></div><div class="item-right docblock-short">This class tracks the per-transaction information needed to build a closing transaction and will
actually build it and sign.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.CommitmentTransaction.html" title="lightning::ln::chan_utils::CommitmentTransaction struct">CommitmentTransaction</a></div><div class="item-right docblock-short">This class tracks the per-transaction information needed to build a commitment transaction and will
actually build it and sign.  It is used for holder transactions that we sign only when needed
and for transactions we sign for the counterparty.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.CounterpartyChannelTransactionParameters.html" title="lightning::ln::chan_utils::CounterpartyChannelTransactionParameters struct">CounterpartyChannelTransactionParameters</a></div><div class="item-right docblock-short">Late-bound per-channel counterparty data used to build transactions.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.CounterpartyCommitmentSecrets.html" title="lightning::ln::chan_utils::CounterpartyCommitmentSecrets struct">CounterpartyCommitmentSecrets</a></div><div class="item-right docblock-short">Implements the per-commitment secret storage scheme from
<a href="https://github.com/lightning/bolts/blob/dcbf8583976df087c79c3ce0b535311212e6812d/03-transactions.md#efficient-per-commitment-secret-storage">BOLT 3</a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.DirectedChannelTransactionParameters.html" title="lightning::ln::chan_utils::DirectedChannelTransactionParameters struct">DirectedChannelTransactionParameters</a></div><div class="item-right docblock-short">Static channel fields used to build transactions given per-commitment fields, organized by
broadcaster/countersignatory.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.HTLCOutputInCommitment.html" title="lightning::ln::chan_utils::HTLCOutputInCommitment struct">HTLCOutputInCommitment</a></div><div class="item-right docblock-short">Information about an HTLC as it appears in a commitment transaction</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.HolderCommitmentTransaction.html" title="lightning::ln::chan_utils::HolderCommitmentTransaction struct">HolderCommitmentTransaction</a></div><div class="item-right docblock-short">Information needed to build and sign a holder’s commitment transaction.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.TrustedClosingTransaction.html" title="lightning::ln::chan_utils::TrustedClosingTransaction struct">TrustedClosingTransaction</a></div><div class="item-right docblock-short">A wrapper on ClosingTransaction indicating that the built bitcoin
transaction is trusted.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.TrustedCommitmentTransaction.html" title="lightning::ln::chan_utils::TrustedCommitmentTransaction struct">TrustedCommitmentTransaction</a></div><div class="item-right docblock-short">A wrapper on CommitmentTransaction indicating that the derived fields (the built bitcoin
transaction and the transaction creation keys) are trusted.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.TxCreationKeys.html" title="lightning::ln::chan_utils::TxCreationKeys struct">TxCreationKeys</a></div><div class="item-right docblock-short">The set of public keys which are used in the creation of one commitment transaction.
These are derived from the channel base keys and per-commitment data.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.HTLCClaim.html" title="lightning::ln::chan_utils::HTLCClaim enum">HTLCClaim</a></div><div class="item-right docblock-short">Describes the type of HTLC claim as determined by analyzing the witness.</div></div></div><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.MAX_ACCEPTED_HTLC_SCRIPT_WEIGHT.html" title="lightning::ln::chan_utils::MAX_ACCEPTED_HTLC_SCRIPT_WEIGHT constant">MAX_ACCEPTED_HTLC_SCRIPT_WEIGHT</a></div><div class="item-right docblock-short">The weight of a BIP141 witnessScript for a BOLT3’s “received HTLC output” can vary in function of its CLTV argument value.
We define a range that encompasses both its non-anchors and anchors variants.
This is the maximum post-anchor value.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.MAX_HTLCS.html" title="lightning::ln::chan_utils::MAX_HTLCS constant">MAX_HTLCS</a></div><div class="item-right docblock-short">Maximum number of one-way in-flight HTLC (protocol-level value).</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.OFFERED_HTLC_SCRIPT_WEIGHT.html" title="lightning::ln::chan_utils::OFFERED_HTLC_SCRIPT_WEIGHT constant">OFFERED_HTLC_SCRIPT_WEIGHT</a></div><div class="item-right docblock-short">The weight of a BIP141 witnessScript for a BOLT3’s “offered HTLC output” on a commitment transaction, non-anchor variant.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.OFFERED_HTLC_SCRIPT_WEIGHT_ANCHORS.html" title="lightning::ln::chan_utils::OFFERED_HTLC_SCRIPT_WEIGHT_ANCHORS constant">OFFERED_HTLC_SCRIPT_WEIGHT_ANCHORS</a></div><div class="item-right docblock-short">The weight of a BIP141 witnessScript for a BOLT3’s “offered HTLC output” on a commitment transaction, anchor variant.</div></div><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.REVOKEABLE_REDEEMSCRIPT_MAX_LENGTH.html" title="lightning::ln::chan_utils::REVOKEABLE_REDEEMSCRIPT_MAX_LENGTH constant">REVOKEABLE_REDEEMSCRIPT_MAX_LENGTH</a></div><div class="item-right docblock-short">The maximum length of a script returned by get_revokeable_redeemscript.</div></div></div><h2 id="functions" class="small-section-header"><a href="#functions">Functions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.build_anchor_input_witness.html" title="lightning::ln::chan_utils::build_anchor_input_witness fn">build_anchor_input_witness</a></div><div class="item-right docblock-short">Returns the witness required to satisfy and spend an anchor input.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.build_closing_transaction.html" title="lightning::ln::chan_utils::build_closing_transaction fn">build_closing_transaction</a></div><div class="item-right docblock-short">Build a closing transaction</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.build_commitment_secret.html" title="lightning::ln::chan_utils::build_commitment_secret fn">build_commitment_secret</a></div><div class="item-right docblock-short">Build the commitment secret from the seed and the commitment number</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.build_htlc_input_witness.html" title="lightning::ln::chan_utils::build_htlc_input_witness fn">build_htlc_input_witness</a></div><div class="item-right docblock-short">Returns the witness required to satisfy and spend a HTLC input.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.build_htlc_transaction.html" title="lightning::ln::chan_utils::build_htlc_transaction fn">build_htlc_transaction</a></div><div class="item-right docblock-short">Builds an unsigned HTLC-Success or HTLC-Timeout transaction from the given channel and HTLC
parameters. This is used by <a href="struct.TrustedCommitmentTransaction.html#method.get_htlc_sigs" title="TrustedCommitmentTransaction::get_htlc_sigs"><code>TrustedCommitmentTransaction::get_htlc_sigs</code></a> to fetch the
transaction which needs signing, and can be used to construct an HTLC transaction which is
broadcastable given a counterparty HTLC signature.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.derive_private_key.html" title="lightning::ln::chan_utils::derive_private_key fn">derive_private_key</a></div><div class="item-right docblock-short">Derives a per-commitment-transaction private key (eg an htlc key or delayed_payment key)
from the base secret and the per_commitment_point.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.derive_private_revocation_key.html" title="lightning::ln::chan_utils::derive_private_revocation_key fn">derive_private_revocation_key</a></div><div class="item-right docblock-short">Derives a per-commitment-transaction revocation key from its constituent parts.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.derive_public_key.html" title="lightning::ln::chan_utils::derive_public_key fn">derive_public_key</a></div><div class="item-right docblock-short">Derives a per-commitment-transaction public key (eg an htlc key or a delayed_payment key)
from the base point and the per_commitment_key. This is the public equivalent of
derive_private_key - using only public keys to derive a public key instead of private keys.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.derive_public_revocation_key.html" title="lightning::ln::chan_utils::derive_public_revocation_key fn">derive_public_revocation_key</a></div><div class="item-right docblock-short">Derives a per-commitment-transaction revocation public key from its constituent parts. This is
the public equivalend of derive_private_revocation_key - using only public keys to derive a
public key instead of private keys.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_anchor_redeemscript.html" title="lightning::ln::chan_utils::get_anchor_redeemscript fn">get_anchor_redeemscript</a></div><div class="item-right docblock-short">Gets the witnessScript for an anchor output from the funding public key.
The witness in the spending input must be:
&lt;BIP 143 funding_signature&gt;
After 16 blocks of confirmation, an alternative satisfying witness could be:
&lt;&gt;
(empty vector required to satisfy compliance with MINIMALIF-standard rule)</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_commitment_transaction_number_obscure_factor.html" title="lightning::ln::chan_utils::get_commitment_transaction_number_obscure_factor fn">get_commitment_transaction_number_obscure_factor</a></div><div class="item-right docblock-short">Commitment transaction numbers which appear in the transactions themselves are XOR’d with a
shared secret first. This prevents on-chain observers from discovering how many commitment
transactions occurred in a channel before it was closed.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_htlc_redeemscript.html" title="lightning::ln::chan_utils::get_htlc_redeemscript fn">get_htlc_redeemscript</a></div><div class="item-right docblock-short">Gets the witness redeemscript for an HTLC output in a commitment transaction. Note that htlc
does not need to have its previous_output_index filled.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_revokeable_redeemscript.html" title="lightning::ln::chan_utils::get_revokeable_redeemscript fn">get_revokeable_redeemscript</a></div><div class="item-right docblock-short">A script either spendable by the revocation
key or the broadcaster_delayed_payment_key and satisfying the relative-locktime OP_CSV constrain.
Encumbering a <code>to_holder</code> output on a commitment transaction or 2nd-stage HTLC transactions.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.get_to_countersignatory_with_anchors_redeemscript.html" title="lightning::ln::chan_utils::get_to_countersignatory_with_anchors_redeemscript fn">get_to_countersignatory_with_anchors_redeemscript</a></div><div class="item-right docblock-short">Gets the witnessScript for the to_remote output when anchors are enabled.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.htlc_success_tx_weight.html" title="lightning::ln::chan_utils::htlc_success_tx_weight fn">htlc_success_tx_weight</a></div><div class="item-right docblock-short">Gets the weight for an HTLC-Success transaction.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.htlc_timeout_tx_weight.html" title="lightning::ln::chan_utils::htlc_timeout_tx_weight fn">htlc_timeout_tx_weight</a></div><div class="item-right docblock-short">Gets the weight for an HTLC-Timeout transaction.</div></div><div class="item-row"><div class="item-left module-item"><a class="fn" href="fn.make_funding_redeemscript.html" title="lightning::ln::chan_utils::make_funding_redeemscript fn">make_funding_redeemscript</a></div><div class="item-right docblock-short">Gets the redeemscript for a funding output from the two funding public keys.
Note that the order of funding public keys does not matter.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="lightning" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.65.0 (897e37553 2022-11-02)" ></div></body></html>