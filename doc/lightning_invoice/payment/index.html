<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A module for paying Lightning invoices and sending spontaneous payments."><meta name="keywords" content="rust, rustlang, rust-lang, payment"><title>lightning_invoice::payment - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../../normalize.css"><link rel="stylesheet" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../../ayu.css" disabled><link rel="stylesheet" href="../../dark.css" disabled><link rel="stylesheet" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script defer src="../../main.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../lightning_invoice/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../../lightning_invoice/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Module payment</a></h2><div class="sidebar-elems"><section><div class="block"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li><li><a href="#types">Type Definitions</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../lightning_invoice/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn"><span class="in-band">Module <a href="../index.html">lightning_invoice</a>::<wbr><a class="mod" href="#">payment</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../src/lightning_invoice/payment.rs.html#10-2312">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A module for paying Lightning invoices and sending spontaneous payments.</p>
<p>Defines an <a href="type.InvoicePayer.html" title="InvoicePayer"><code>InvoicePayer</code></a> utility for sending payments, parameterized by <a href="trait.Payer.html" title="Payer"><code>Payer</code></a> and
<a href="../../lightning/routing/router/trait.Router.html" title="Router"><code>Router</code></a> traits. Implementations of <a href="trait.Payer.html" title="Payer"><code>Payer</code></a> provide the payer’s node id, channels, and means
to send a payment over a <a href="../../lightning/routing/router/struct.Route.html" title="Route"><code>Route</code></a>. Implementations of <a href="../../lightning/routing/router/trait.Router.html" title="Router"><code>Router</code></a> find a <a href="../../lightning/routing/router/struct.Route.html" title="Route"><code>Route</code></a> between payer
and payee using information provided by the payer and from the payee’s <a href="../struct.Invoice.html" title="Invoice"><code>Invoice</code></a>, when
applicable.</p>
<p><a href="type.InvoicePayer.html" title="InvoicePayer"><code>InvoicePayer</code></a> uses its <a href="../../lightning/routing/router/trait.Router.html" title="Router"><code>Router</code></a> parameterization for optionally notifying scorers upon
receiving the <a href="../../lightning/util/events/enum.Event.html#variant.PaymentPathFailed" title="Event::PaymentPathFailed"><code>Event::PaymentPathFailed</code></a> and <a href="../../lightning/util/events/enum.Event.html#variant.PaymentPathSuccessful" title="Event::PaymentPathSuccessful"><code>Event::PaymentPathSuccessful</code></a> events.
It also does the same for payment probe failure and success events using <a href="../../lightning/util/events/enum.Event.html#variant.ProbeFailed" title="Event::ProbeFailed"><code>Event::ProbeFailed</code></a>
and <a href="../../lightning/util/events/enum.Event.html#variant.ProbeSuccessful" title="Event::ProbeSuccessful"><code>Event::ProbeSuccessful</code></a>.</p>
<p><a href="type.InvoicePayer.html" title="InvoicePayer"><code>InvoicePayer</code></a> is capable of retrying failed payments. It accomplishes this by implementing
<a href="../../lightning/util/events/trait.EventHandler.html" title="EventHandler"><code>EventHandler</code></a> which decorates a user-provided handler. It will intercept any
<a href="../../lightning/util/events/enum.Event.html#variant.PaymentPathFailed" title="Event::PaymentPathFailed"><code>Event::PaymentPathFailed</code></a> events and retry the failed paths for a fixed number of total
attempts or until retry is no longer possible. In such a situation, <a href="type.InvoicePayer.html" title="InvoicePayer"><code>InvoicePayer</code></a> will pass
along the events to the user-provided handler.</p>
<h2 id="example"><a href="#example">Example</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>event_handler = |event: Event| {
    <span class="kw">match </span>event {
        Event::PaymentPathFailed { .. } =&gt; <span class="macro">println!</span>(<span class="string">&quot;payment failed after retries&quot;</span>),
        Event::PaymentSent { .. } =&gt; <span class="macro">println!</span>(<span class="string">&quot;payment successful&quot;</span>),
        <span class="kw">_ </span>=&gt; {},
    }
};
<span class="kw">let </span>invoice_payer = InvoicePayer::new(<span class="kw-2">&amp;</span>payer, <span class="kw-2">&amp;</span>router, <span class="kw-2">&amp;</span>logger, event_handler, Retry::Attempts(<span class="number">2</span>));

<span class="kw">let </span>invoice = <span class="string">&quot;...&quot;</span>;
<span class="kw">if let </span><span class="prelude-val">Ok</span>(invoice) = invoice.parse::&lt;Invoice&gt;() {
    invoice_payer.pay_invoice(<span class="kw-2">&amp;</span>invoice).unwrap();

    <span class="kw">loop </span>{
        event_provider.process_pending_events(<span class="kw-2">&amp;</span>invoice_payer);
    }
}</code></pre></div>
<h2 id="note"><a href="#note">Note</a></h2>
<p>The <a href="../../lightning/routing/router/struct.Route.html" title="Route"><code>Route</code></a> is computed before each payment attempt. Any updates affecting path finding such
as updates to the network graph or changes to channel scores should be applied prior to
retries, typically by way of composing <a href="../../lightning/util/events/trait.EventHandler.html" title="EventHandler"><code>EventHandler</code></a>s accordingly.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.InvoicePayerUsingTime.html" title="lightning_invoice::payment::InvoicePayerUsingTime struct">InvoicePayerUsingTime</a></div><div class="item-right docblock-short">(C-not exported) generally all users should use the <a href="type.InvoicePayer.html" title="InvoicePayer"><code>InvoicePayer</code></a> type alias.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.PaymentError.html" title="lightning_invoice::payment::PaymentError enum">PaymentError</a></div><div class="item-right docblock-short">An error that may occur when making a payment.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Retry.html" title="lightning_invoice::payment::Retry enum">Retry</a></div><div class="item-right docblock-short">Strategies available to retry payment path failures for an <a href="../struct.Invoice.html" title="Invoice"><code>Invoice</code></a>.</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.Payer.html" title="lightning_invoice::payment::Payer trait">Payer</a></div><div class="item-right docblock-short">A trait defining behavior of an <a href="../struct.Invoice.html" title="Invoice"><code>Invoice</code></a> payer.</div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.InvoicePayer.html" title="lightning_invoice::payment::InvoicePayer type">InvoicePayer</a></div><div class="item-right docblock-short">A utility for paying <a href="../struct.Invoice.html" title="Invoice"><code>Invoice</code></a>s and sending spontaneous payments.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="lightning_invoice" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.65.0 (897e37553 2022-11-02)" ></div></body></html>